<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>QR Generator</title>
  <style>
    body { font-family: -apple-system, system-ui, Segoe UI, Roboto, Arial, sans-serif; background:#f5f5f5; display:flex; flex-direction:column; align-items:center; padding:24px; }
    h1 { color:#046b30; margin:12px 0; font-weight:700; }
    .card { background:#fff; border-radius:16px; box-shadow:0 6px 24px rgba(0,0,0,.12); padding:16px; width:min(720px,92vw); }
    .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    input[type=text]{ flex:1; padding:12px 14px; font-size:16px; border-radius:10px; border:1px solid #d4d7dc; }
    button{ cursor:pointer; padding:12px 16px; font-size:16px; border-radius:12px; border:none; background:linear-gradient(45deg,#046b30,#00c5a0); color:#fff; font-weight:600; }
    canvas{ margin-top:14px; border-radius:16px; background:#fff; }
    .error{ display:none; margin-top:8px; color:#a40000; background:#ffecec; border:1px solid #ffb2b2; padding:8px 10px; border-radius:8px; }
  </style>
</head>
<body>
  <h1>QR Generator</h1>
  <div class="card">
    <div class="row">
      <input id="linkInput" type="text" placeholder="Enter or paste a URL" value="https://www.one.nz">
      <button id="btnGenerate" type="button">Generate</button>
      <button id="btnDownload" type="button">Download</button>
    </div>
    <div id="err" class="error"></div>
    <canvas id="qrCanvas"></canvas>
  </div>

  <!-- Primary QR library CDN -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js" defer></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const canvas = document.getElementById('qrCanvas');
      const ctx = canvas.getContext('2d');
      const input = document.getElementById('linkInput');
      const errBox = document.getElementById('err');

      function ensureLib(cb){
        if (window.QRCode && typeof QRCode.toDataURL==='function') return cb();
        const s=document.createElement('script');
        s.src='https://unpkg.com/qrcode/build/qrcode.min.js';
        s.onload=cb;
        s.onerror=()=>{ errBox.style.display='block'; errBox.textContent='Could not load QR library. Allow cdn.jsdelivr.net or unpkg.com in any content blocker.'; };
        document.head.appendChild(s);
      }

      async function generate(){
        ensureLib(async () => {
          let url = (input.value || '').trim();
          if (!url) return;
          if (!/^https?:\/\//i.test(url)) url = 'https://' + url;

          try{
            const dataUrl = await QRCode.toDataURL(url, { errorCorrectionLevel:'H', margin:1, width:540, color:{dark:'#000000', light:'#FFFFFF'} });
            const img = new Image(); img.src = dataUrl;
            img.onload = () => {
              const size = 540, quiet = 44;
              canvas.width = size + quiet*2; canvas.height = size + quiet*2;
              const g = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
              g.addColorStop(0,'#046b30'); g.addColorStop(1,'#00c5a0');
              ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width,canvas.height);
              ctx.fillStyle = '#fff'; ctx.fillRect(quiet,quiet,size,size);
              ctx.drawImage(img, quiet, quiet, size, size);
            };
          }catch(e){
            errBox.style.display='block'; errBox.textContent='Error: ' + (e?.message || e);
          }
        });
      }

      function download(){
        if (!canvas.width) return;
        const a=document.createElement('a');
        a.download='qr-code.png';
        a.href=canvas.toDataURL('image/png');
        a.click();
      }

      document.getElementById('btnGenerate').addEventListener('click', generate);
      document.getElementById('btnDownload').addEventListener('click', download);

      generate(); // auto
    });
  </script>
</body>
</html>
